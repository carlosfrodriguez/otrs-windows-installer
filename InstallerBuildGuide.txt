# --
# InstallerBuildGuide.txt - guide to prepare components to build a win installer
# Copyright (C) 2001-2010 OTRS AG, http://otrs.org/
# --
# $Id: InstallerBuildGuide.txt,v 1.18 2010-10-25 11:22:20 mb Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

Prepare Prerequisites
=====================

    1. Download and install the newest NSIS installer from
       http://nsis.sourceforge.net/

    2. Install the NSIS Simple Firewall Plugin
        -Download the most recent version from http://nsis.sourceforge.net/NSIS_Simple_Firewall_Plugin
        -Extract the files
        -Copy SimpleFC.dll to your NSIS Plugin directory (e. g. C:\Program Files\NSIS\Plugins)

    2. Download and install the newest Eclipse framework from
       http://www.eclipse.org/

    3. Download and install the most recent EclipseNSIS plugin
        -Start Eclipse
        -Click Help > Install New Software
        -Add http://eclipsensis.sf.net/update as software location
        -Install EclipseNSIS

Prepare otrs4win
================

    1. Checkout the module otrs4win in the local directory C:\otrs4win

    2. Create a new project in your Eclipse

Prepare OTRS
============

    1. Download the newest version of OTRS from ftp.otrs.org

    2. Unzip the content to C:\otrs4win\OTRS\

    3. Update the version number (and the version postfix) in the OTRS.nsi file

Prepare Strawberry Perl
=======================

    1. Download the latest Portable version of Strawberry Perl from
        http://strawberryperl.com/

    2. Extract the files to C:\strawberry\

    3. Install CPAN modules using the CPAN shell

        # OTRS modules
        cpan> install Date::Pcalc
        cpan> install Date::Format
        cpan> install Crypt::PasswdMD5
        cpan> install Mail::Internet
        cpan> install MIME::Tools
        cpan> install enum
        cpan> install Net::IP
        cpan> install Win32::IPHelper
        cpan> install Win32::Registry
        # small workaround needed for https://rt.cpan.org/Public/Bug/Display.html?id=57039
        cpan> get Net::DNS
        cpan> look

        now change
        Change line 2 in netdns.h from:

        #if defined(_MSC_VER) || defined(__MINGW32_VERSION)
            to
        #if defined(_MSC_VER) || defined(__MINGW32__)

        perl Makefile.PL
        dmake
        dmake test
        dmake install
        exit

        # cpan> install Net::DNS

        # Net::Server is a prerequisite for Coro, which itself is a prerequisite for Net::IMAP::Simple.
        # One of the Net::Server tests is broken, at least on our Perl.

        cpan> notest install Net::Server
        cpan> install Net::IMAP::Simple  # LOTS of dependencies
        cpan> install Authen::SASL
        cpan> install Net::LDAP
        cpan> install PDF::API2
        cpan> install Text::CSV_XS
        cpan> install Apache::DBI
        cpan> install Encode::HanExtra
        cpan> install SOAP::Lite
        cpan> install GD::Text
        cpan> install GD::Graph

        # Install GSSAPI for some connections to Exchange servers
        # Copy the libraries for libidn and kfw from the following url and extract the zips in the
        # strawberry dir: http://strawberryperl.com/package/kmx/32_libs/
        cpan> install Net::LibIDN
        # GSSAPI needs a build flag
        cpan> get GSSAPI
        cpan> look GSSAPI

        perl Makefile.PL --gssapi_libs=-lgssapi32 --gssapi_inc=-DSSIZE_T_DEFINED
        dmake
        dmake test
        dmake install
        exit

        # CronW
        cpan> install Date::Manip
        cpan> install Log::Dispatch

        # There's an issue with test 17 of Log::Log4perl; will be fixed in upcoming 1.31 release
        # see https://rt.cpan.org/Public/Bug/Display.html?id=60665
        cpan> notest install Log::Log4perl
        cpan> install Log::Dispatch::FileRotate
        cpan> install Win32::Daemon

    4. Clean the system and quit
        cpan> reload cpan
        cpan> clean
        cpan> quit

    5. Add mod_perl
        Install mod_perl binaries with the following commands (ref: http://strawberryperl.com/package/kmx/mod_perl/README-512.TXT)
        pip http://strawberryperl.com/package/kmx/mod_perl/5.12_x86/mod_perl-2.0.4-MSWin32-x86-multi-thread-5.12.par
        pip http://strawberryperl.com/package/kmx/mod_perl/5.12_x86/libapreq2-2.12-MSWin32-x86-multi-thread-5.12.par

    6. Delete the cpan directory to save space
        del c:\strawberry\cpan

    7. Delete the temp directory
        del c:\strawberry\temp

    8. Copy the strawberry perl files to C:\otrs4win\StrawberryPerl\


Prepare Apache
==============

    1. Download the most recent Apache server with SSL!! from
       http://httpd.apache.org/

    2. Install it on a test system to extract the needed files
        -Set "somenet.com" as network domain
        -Set "webmaster@somenet.com" as administrator's email address
        -Install it for all users on port 80
        -Select "Custom" as install type
        -Select all components but deselect "Apache Documentation" and
         "Apache Service Taskbar Icon"
        -Install the Apache to C:\Apache
        -Start the installation

    3. Stop the apache service

    4. Copy the apache files to C:\otrs4win\Apache\

    5. Download the following files and store them in C:\otrs4win\Apache\Modules
        http://strawberryperl.com/package/kmx/mod_perl/5.12_x86/mod_perl.so
        http://strawberryperl.com/package/kmx/mod_perl/5.12_x86/mod_apreq2.so
        http://strawberryperl.com/package/kmx/mod_perl/5.12_x86/libapreq2.dll

Prepare MySQL
=============

    1. Download the most recent MySQL server "Windows Essentials (x86)" from
       http://dev.mysql.com/downloads/

    2. Install it on a test system to extract the needed files
        -Select "Custom" installation method
        -Select ALL components
        -Install the MySQL server to C:\MySQL

    3. Copy the mysql files to C:\otrs4win\MySQL\

Prepare CRONw
=============

    1. Download the most recent CRONw from http://cronw.sourceforge.net/

    2. Copy the CRONw files to C:\otrs4win\CRONw\

    3. Delete the useless modules directory
        del C:\otrs4win\CRONw\modules

Build the Installer
===================

    1. Start your Eclipse

    2. Open the OTRS.nsi file

    3. Build the installer
